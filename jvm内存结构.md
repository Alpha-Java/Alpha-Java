# jvm内存结构

- 程序计数器

  - 定义：Program Counter Register
  - 作用：记录下一条jvm指令的执行地址，解释器从程序计数器中拿到指令地址。
  - 物理上通过寄存器实现。（寄存器是CPU组件中读取速度最快的，读写jvm指令是非常频繁的操作）
  - ![image-20210222163602649](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210222163602649.png)
  - 特点
    - 线程私有
    - 不存在内存溢出（唯一一个区域）

- 虚拟机栈

  每个线程运行时所需要的内存空间，称为虚拟机栈（Java Virtual Machine Stack）。

  栈由栈帧（Frame）组成，一个人栈帧对应一次方法的调用。栈帧包括参数、局部变量、返回地址。方法执行时预先获取内存空间。压栈：获取内存。出栈：释放内存。

  每个线程只能有一个活动栈帧，对应当前正在执行的方法。

  

  问题辨析：

  1.垃圾回收是否涉及栈内存？不涉及，垃圾回收管理的是堆内存中的无用对象，栈内存里是每次方法的调用，方法执行完会自动释放内存。

  2.栈内存越大越好吗？不是。物理内存一定的情况下，栈的大小越大，会导致可同时运行的线程数减少。

  ![image-20210222171146574](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210222171146574.png)

  3.方法内的局部变量是否是线程安全的？

  判断线程是否安全，就是看这个变量是否是多个线程共享。1）判断是否是局部变量，2）判断是否逃离了方法的作用范围。

  栈内存溢出

  java.lang.StackOverflowError

  1）栈帧过多。方法的递归调用，没有设置一个正确的结束条件。

  2）栈帧内存过大
  



诊断cpu占用过高

1.top命令查看进程占用计算机资源的情况，找出占用过高的pid

2.ps H -eo pid,tid,%cpu | grep 进程id，找出占用过高的线程id

3.jstack 进程id 查看java进程中每个线程的情况



诊断死锁

jstack 进程id 



- 本地方法栈

  供本地方法运行的内存空间

- 堆（heap）

  通过new关键字，创建的对象都会用到堆内存

  线程共享，考虑线程安全

  有垃圾回收机制

  虚拟机参数：-Xmx8m 指定堆内存的大小

  - jps工具

    查看当期那系统中有哪些java程序

  - jmap工具

    jmap -heap 进程id

    查看当前系统堆内存占用情况

  - jconsole工具

    图形界面的，多功能的监测工具，可以连续监测

  案例：垃圾回收后，内存占用仍然很高

  ​	jvirsualvm 堆dump 获取堆内存快照，观察对象内存的占用情况（个数，大小）

- 方法区

  方法区存放的是Class的信息（属性，构造器），Classloader，常量池等。

  方法区在逻辑上属于堆得一部分，各个jvm厂商在实现上可不放在堆内存中。

  jdk1.8 之前 堆内存的永久代

  jdk1.8及以后 元空间 操作系统的内存



​		内存溢出场景：

​		字节码技术，在运行期间动态的生成字节码，完成动态的类加载。

​		spring aop 动态代理，生成代理类

​		mybatis 生成mapper接口的实现类



​		类的二进制字节码主要包含三部分

- 类基本信息
- 常量池
- 类方法定义（虚拟机指令）



​	常量池，就是一张表，虚拟机指令根据这张表找到要执行的类名、方法名、参数类型、字面量信息等。

​	运行时常量池，常量池时*.class文件中的，当该类被加载进内存中时，常量池信息就会放入运行时常量池，并且里面的符号地址变为真实的地址。





StringTable 串池

hash表实现，长度固定，不可扩容



直接内存

FULL GC比较影响性能，会造成程序的暂停时间比较长。

虚引用对象Cleaner 

先出发java中的垃圾回收，ByteBuffer对象回收后，才会释放直接内存。







数据结构与算法

jvm

多线程

设计模式

分布式（dubbo + zk） 分布式事务

数据库

数据库优化

redis

MQ

计算机网络



项目

- 核心模块
- 亮点



























template_award 

award_category









